sudo: required

dist: trusty

branches:
  gh_pages: true

env:
  - TEST_SUITE=lint
  - TEST_SUITE=unit
  - TEST_SUITE=e2e

language: node_js

node_js: stable

cache:
  directories:
    - node_modules

before_install:
  - if [[ $TEST_SUITE = "e2e" ]]; then export CHROME_BIN=/usr/bin/google-chrome; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then export DISPLAY=:99.0; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then sh  -e /etc/init.d/xvfb start; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then sudo apt-get update; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then sudo apt-get install  -y libappindicator1 fonts-liberation; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb; fi
  - if [[ $TEST_SUITE = "e2e" ]]; then sudo dpkg -i google-chrome*.deb; fi

script:
  - if [[ $TEST_SUITE = "e2e" ]]; then jdk_switcher use oraclejdk8; fi
  - "npm run $TEST_SUITE"

before_deploy:
  - npm run build

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  local_dir: dist
  target_branch: deploy
  on:
    branch: master

